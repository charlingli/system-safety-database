<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../templates/masterTemplate.xhtml">
            <ui:define name="content">
                <h:form>
                    <p:messages autoUpdate="true" showSummary="true" />
                    <div class="pagePath"><h:outputText value="#{pagePath_MB.pageHtmlPath}" escape="false"/></div>
                    <p:panel rendered="#{hazardsRelation_MB.searchBox}" styleClass="searchPanel">
                        <h:panelGrid columns="2" rendered="#{hazardsRelation_MB.searchBox}" columnClasses="left,middle">
                            <p:outputLabel value="Hazard ID: " />
                            <p:inputText value="#{hazardsRelation_MB.hazardId}"/>
                            <p:outputLabel value="Hazard Description: " />
                            <p:inputText value="#{hazardsRelation_MB.hazardDescrÃ­ption}" />
                            <p:outputLabel value="Hazard Comment: " />
                            <p:inputText value="#{hazardsRelation_MB.hazardComment}" />
                            <p:outputLabel value="Hazard Workshop: " />
                            <p:inputText value="#{hazardsRelation_MB.hazardWorkshop}" />
                        </h:panelGrid>
                    </p:panel>
                    <div class="panelButtons" style="display:#{(hazardsRelation_MB.searchBox)?'block':'none'}">
                        <p:commandButton value="Search">
                            <f:ajax listener="#{hazardsRelation_MB.searchHazards()}" execute="@form" render="@form"/>
                        </p:commandButton>
                    </div>
                    <p:dataTable value="#{hazardsRelation_MB.listHazards}" var="hazard" rendered="#{hazardsRelation_MB.dataTable}" emptyMessage="No hazard entries found with given criteria."
                                 styleClass="resultPanel">
                        <f:facet name="header">
                            <p:outputPanel>
                                <h:outputText value="Select from the following hazards: " />
                            </p:outputPanel>
                        </f:facet>
                        <p:column headerText="Hazard ID" styleClass="small">
                            <p:outputLabel value="#{hazard.hazardId}"/>
                        </p:column>
                        <p:column headerText="Hazard Description">
                            <p:outputLabel value="#{hazard.hazardDescription}"/>
                        </p:column>
                        <p:column headerText="Hazard Comment">
                            <p:outputLabel value="#{hazard.hazardComment}"/>
                        </p:column>
                        <p:column headerText="Hazard Workshop">
                            <p:outputLabel value="#{hazard.hazardWorkshop}"/>
                        </p:column>
                        <p:column headerText="Actions" styleClass="small">
                            <h:commandLink value="Include relations" action="#{hazardsRelation_MB.includeRelations(hazard)}" styleClass="commandLink"/>
                        </p:column>
                    </p:dataTable>
                    <p:panel id="hazardGroup" rendered="#{hazardsRelation_MB.infoBox}" styleClass="detailHazardPanel">
                        <div class="p-heading-spacer">
                            <p:outputLabel styleClass="p-heading" value="Updating relations to the hazard:"/>
                        </div>
                        <p:panelGrid columns="2" class="detailTable" columnClasses="label"> 
                            <p:outputLabel value="Hazard ID: "/>
                            <p:outputLabel value="#{hazardsRelation_MB.hazardObject.hazardId}" />
                            <p:outputLabel value="Hazard Location: " />
                            <p:outputLabel value="#{hazardsRelation_MB.hazardObject.hazardLocation.locationName}" />
                            <p:outputLabel value="Hazard Description: " />
                            <p:outputLabel value="#{hazardsRelation_MB.hazardObject.hazardDescription}" />
                            <p:outputLabel value="Hazard Comment: " />
                            <p:outputLabel value="#{hazardsRelation_MB.hazardObject.hazardComment}" />
                            <p:outputLabel value="Hazard Workshop: " />
                            <p:outputLabel value="#{hazardsRelation_MB.hazardObject.hazardWorkshop}" />
                        </p:panelGrid>
                    </p:panel>
                    <p:panel id="causesPanel" rendered="#{hazardsRelation_MB.infoBox}" styleClass="detailHazardPanel">
                        <div class="p-emphasis-spacer">
                            <h:outputText styleClass="p-emphasis" value="The following causes are associated with the current hazard:"/>
                        </div>
                        <p:dataTable value="#{hazardsRelation_MB.listHazardCauses}" var="cause" emptyMessage="No causes are associated with this hazard.">
                            <p:column headerText="Cause Id" styleClass="small">
                                <p:outputLabel value="#{cause.dbCause.causeId}"/>
                            </p:column>
                            <p:column headerText="Cause Description">
                                <p:outputLabel value="#{cause.dbCause.causeDescription}"/>
                            </p:column>
                            <p:column headerText="Actions" styleClass="small"> 
                                <h:commandLink value="Delete" styleClass="commandLink">
                                    <f:ajax listener="#{hazardsRelation_MB.deleteHazardCauses(cause)}" execute="@form" render="@form"/>    
                                </h:commandLink>
                            </p:column>
                        </p:dataTable>
                        <div class="p-emphasis-spacer">
                            <p:commandLink value="Add Cause" class="commandLink" styleClass="commandLink">
                                <f:ajax listener="#{hazardsRelation_MB.addCauseVisible()}" execute="@form" render="@form"/>
                            </p:commandLink>
                        </div>
                        <div class="p-emphasis-spacer">
                            <h:panelGrid columns="2" rendered="#{hazardsRelation_MB.addCause}" columnClasses="left,middle">
                                <p:outputLabel value="Cause Description: " for="addCauses" />
                                <p:autoComplete id="addCauses" multiple="true" value="#{hazardsRelation_MB.listSelectedCauses}" completeMethod="#{hazardsRelation_MB.showUnrelCauses}"
                                                var="cause1" itemLabel="Cause No #{cause1.causeId}" itemValue="#{cause1}" converter="causeConverter" forceSelection="true">
                                    <p:column>
                                        <h:outputText value="#{cause1.causeId}" />
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{cause1.causeDescription}" />
                                    </p:column>
                                </p:autoComplete>
                            </h:panelGrid>
                            <div class="panelButtons">
                                <p:commandButton rendered="#{hazardsRelation_MB.addCause}" value="Save Causes">
                                    <f:ajax listener="#{hazardsRelation_MB.addHazardCauses()}" execute="@form" render="@form"/>
                                </p:commandButton>
                                <p:commandButton rendered="#{hazardsRelation_MB.addCause}" value="Cancel">
                                    <f:ajax listener="#{hazardsRelation_MB.addCauseCancel()}" execute="@form" render="@form"/>
                                </p:commandButton>
                            </div>
                        </div>
                    </p:panel>
                    <p:panel id="consqsPanel" rendered="#{hazardsRelation_MB.infoBox}" styleClass="detailHazardPanel">
                        <div class="p-emphasis-spacer">
                            <h:outputText styleClass="p-emphasis" value="The following consequences are associated with the current hazard:"/>
                        </div>
                        <p:dataTable value="#{hazardsRelation_MB.listHazardConsqs}" var="consequence" emptyMessage="No consequences are associated with this hazard.">
                            <p:column headerText="Consequence Id" styleClass="small">
                                <p:outputLabel value="#{consequence.dbConsequence.consequenceId}"/>
                            </p:column>
                            <p:column headerText="Consequence Description">
                                <p:outputLabel value="#{consequence.dbConsequence.consequenceDescription}"/>
                            </p:column>
                            <p:column headerText="Actions" styleClass="small"> 
                                <h:commandLink value="Delete" styleClass="commandLink">
                                    <f:ajax listener="#{hazardsRelation_MB.deleteHazardConsqs(consequence)}" execute="@form" render="@form"/>    
                                </h:commandLink>
                            </p:column>
                        </p:dataTable>
                        <div class="p-emphasis-spacer">
                            <p:commandLink value="Add Consequence" styleClass="commandLink">
                                <f:ajax listener="#{hazardsRelation_MB.addConquenceVisible()}" execute="@form" render="@form"/>
                            </p:commandLink>
                        </div>
                        <h:panelGrid columns="2" rendered="#{hazardsRelation_MB.addConq}" columnClasses="left,middle">
                            <p:outputLabel value="Consequence Description: " for="addConsqs" />
                            <p:autoComplete id="addConsqs" multiple="true" value="#{hazardsRelation_MB.listSelectedConsqs}" completeMethod="#{hazardsRelation_MB.showUnrelConsqs}"
                                            var="consq1" itemLabel="Consequence No #{consq1.consequenceId}" itemValue="#{consq1}" converter="consqConverter" forceSelection="true">
                                <p:column>
                                    <h:outputText value="#{consq1.consequenceId}" />
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{consq1.consequenceDescription}" />
                                </p:column>
                            </p:autoComplete>
                        </h:panelGrid>
                        <div class="panelButtons">
                            <p:commandButton rendered="#{hazardsRelation_MB.addConq}" value="Save Consequences">
                                <f:ajax listener="#{hazardsRelation_MB.addHazardConsequences()}" execute="@form" render="@form"/>
                            </p:commandButton>
                            <p:commandButton rendered="#{hazardsRelation_MB.addConq}" value="Cancel">
                                <f:ajax listener="#{hazardsRelation_MB.addConquenceCancel()}" execute="@form" render="@form"/>
                            </p:commandButton>
                        </div>
                    </p:panel>
                    <p:panel id="controlsGroup" rendered="#{hazardsRelation_MB.infoBox}" styleClass="detailHazardPanel">
                        <div class="p-emphasis-spacer">
                            <h:outputText styleClass="p-emphasis" value="The following controls are associated with the current hazard:"/>
                        </div>
                        <p:dataTable value="#{hazardsRelation_MB.listHazardControls}" var="control" emptyMessage="No controls are associated with this hazard.">
                            <p:column headerText="Control Id" styleClass="small">
                                <p:outputLabel value="#{control.dbControl.controlId}"/>
                            </p:column>
                            <p:column headerText="Control Description">
                                <p:outputLabel value="#{control.dbControl.controlDescription}"/>
                            </p:column>
                            <p:column headerText="Control Owner" styleClass="small">
                                <p:outputLabel value="#{control.dbControl.ownerId.ownerName}"/>
                            </p:column>
                            <p:column headerText="Control Hierarchy" styleClass="small">
                                <p:outputLabel value="#{control.dbControl.controlHierarchyId.controlHierarchyName}"/>
                            </p:column>
                            <p:column headerText="Control Type" styleClass="small">
                                <p:outputLabel value="#{control.controlType == 'P' ? 'Preventive' : control.controlType == 'M' ? 'Mitigative' : control.controlType}"/>
                            </p:column>
                            <p:column headerText="Recommendation" styleClass="small">
                                <p:outputLabel value="#{control.controlRecommendId.controlRecommendName}"/>
                            </p:column>
                            <p:column headerText="Justification">
                                <p:outputLabel value="#{control.controlJustify}"/>
                            </p:column>
                            <p:column headerText="Actions" styleClass="small"> 
                                <h:commandLink value="Edit" styleClass="commandLink">
                                    <f:ajax listener="#{hazardsRelation_MB.editControlVisible(control)}" execute="@form" render="@form"/>    
                                </h:commandLink>
                                |
                                <h:commandLink value="Delete" styleClass="commandLink">
                                    <f:ajax listener="#{hazardsRelation_MB.deleteHazardControls(control)}" execute="@form" render="@form"/>    
                                </h:commandLink>
                            </p:column>
                        </p:dataTable>
                        <div class="p-emphasis-spacer">
                            <p:commandLink value="Add Control" styleClass="commandLink">
                                <f:ajax listener="#{hazardsRelation_MB.addControlVisible()}" execute="@form" render="@form"/>
                            </p:commandLink>
                        </div>
                        <h:panelGrid columns="2" rendered="#{hazardsRelation_MB.addControl}" columnClasses="left,middle">
                            <p:outputLabel value="Control Description: " for="addControls" />
                            <p:autoComplete id="addControls" value="#{hazardsRelation_MB.controlHazardObject.dbControl}" completeMethod="#{hazardsRelation_MB.showUnrelControls}"
                                            var="control1" itemLabel="#{control1.controlId}" itemValue="#{control1}" converter="controlConverter" forceSelection="true"
                                            disabled="#{hazardsRelation_MB.txtControlIdHazard}">
                                <p:column>
                                    <h:outputText value="#{control1.controlId}" />
                                </p:column>
                                <p:column>
                                    <h:outputText value="#{control1.controlDescription}" />
                                </p:column>
                            </p:autoComplete>
                            <p:outputLabel value="Control Type: " for="controlType" />
                            <p:selectOneMenu id="controlType" value="#{hazardsRelation_MB.controlType}">
                                <f:selectItem itemValue="M" itemLabel="Mitigative" />
                                <f:selectItem itemValue="P" itemLabel="Preventive" />
                            </p:selectOneMenu>
                            <p:outputLabel value="Control Recommendation: " for="controlRecommend" />
                            <p:selectOneMenu id="controlRecommend" value="#{hazardsRelation_MB.controlRecommendId}" required="true">
                                <f:selectItems value="#{hazardsRelation_MB.listControlRecommends}" var="ctlRecomm" itemValue="#{ctlRecomm.controlRecommendId}" itemLabel="#{ctlRecomm.controlRecommendName}" />
                                <f:ajax listener="#{hazardsRelation_MB.loadJustify}" execute="@form" render="@form" />
                            </p:selectOneMenu>
                            <p:outputLabel value="Justification: *" for="controlJustify" rendered="#{hazardsRelation_MB.addControlJustify}"/>
                            <p:inputTextarea id="controlJustify" value="#{hazardsRelation_MB.controlJustify}" rendered="#{hazardsRelation_MB.addControlJustify}"/>
                        </h:panelGrid>
                        <div class="panelButtons">
                            <p:commandButton value="Save Control" rendered="#{hazardsRelation_MB.addControl}">
                                <f:ajax listener="#{hazardsRelation_MB.addHazardControls()}" execute="@form" render="@form"/>
                            </p:commandButton>
                            <p:commandButton value="Cancel" rendered="#{hazardsRelation_MB.addControl}" immediate="true">
                                <f:ajax listener="#{hazardsRelation_MB.addControlCancel()}" execute="@form" render="@form"/>
                            </p:commandButton>
                        </div>
                    </p:panel>
                    <div class="panelButtons" style="display:#{(hazardsRelation_MB.cancelBtn)?'block':'none'}">
                        <p:commandButton value="Back">
                            <f:ajax listener="#{hazardsRelation_MB.cancel()}" execute="@form" render="@form"/>
                        </p:commandButton>
                    </div>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
