<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../templates/masterTemplate.xhtml">
            <ui:define name="content">
                <h:form id="wfForm">
                    <p:hotkey bind="esc" handler="PF('detailOverlay').hide(); PF('requestOverlay').hide()"></p:hotkey>
                    <div class="messageDiv"><p:messages autoUpdate="true" showDetail="true" showSummary="false" styleClass="messageDiv"/></div>
                    <p:dialog id="detailDialog" header="Workflow Detail" widgetVar="detailOverlay" height="70vh" width="70vw">
                        <p:panel id="hazardPanel" styleClass="detailHazardPanel">
                            <div class="p-heading-spacer">
                                <p:outputLabel styleClass="p-heading" value="Viewing details of the workflow:"/>
                            </div>
                            <p:panelGrid columns="4" class="detailTable" columnClasses="label,,label"> 
                                <p:outputLabel value="Workflow ID: "/>
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfId}" />
                                <p:outputLabel value="Comment 1: "/>
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfComment1}" />
                                <p:outputLabel value="Workflow Object Type &amp; Id "/>
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfObjectName} : #{managementWF_MB.detailWF.wfObjectId}" />
                                <p:outputLabel value="Comment 2 " />
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfComment2}" />
                                <p:outputLabel value="Workflow Status &amp; Last Update "/>
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfStatus == 'O' ? 'Open' : managementWF_MB.detailWF.wfStatus == 'A' ? 'Approved' : managementWF_MB.detailWF.wfStatus == 'R' ? 'Rejected' : managementWF_MB.detailWF.wfStatus == 'I' ? 'Open' : managementWF_MB.detailWF.wfStatus} as of #{managementWF_MB.detailWF.wfUpdatedDateTime == null ? managementWF_MB.detailWF.wfAddedDateTime : managementWF_MB.detailWF.wfUpdatedDateTime}" />
                                <p:outputLabel value="Comment 3 " />
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfComment3}" />
                                <p:outputLabel value="Workflow Owner "/>
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfUserIdAdd.firstName} #{managementWF_MB.detailWF.wfUserIdAdd.lastName}" />
                                <p:outputLabel value="Comment 4 " />
                                <p:outputLabel value="#{managementWF_MB.detailWF.wfComment4}" />
                            </p:panelGrid>
                        </p:panel>
                        <p:panel styleClass="detailHazardPanel">
                            <h:outputText value="The workflow has the updates:" class="p-emphasis"/>
                            <p:dataTable value="#{managementWF_MB.detailLine}" var="line" emptyMessage="No updates have been made to this workflow.">
                                <p:column headerText="Update User" styleClass="small">
                                    <p:outputLabel value="#{line.wfUserIdApprover.firstName} #{line.wfUserIdApprover.lastName}"/>
                                </p:column>
                                <p:column headerText="Update Decision" styleClass="small">
                                    <p:outputLabel value="#{line.wfApproverDecisionId.wfDecisionName}"/>
                                </p:column>
                                <p:column headerText="Update Comments">
                                    <p:outputLabel value="#{line.wfApprovalComment}"/>
                                </p:column>
                                <p:column headerText="Update Timestamp">
                                    <p:outputLabel value="#{line.wfDateTimeDecision}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:dialog>
                    <p:dialog id="requestDialog" header="Request Information" widgetVar="requestOverlay" height="18vh" width="32vw">
                        <p:panel styleClass="detailHazardPanel">
                            <h:outputText value="Information requested from the workflow owner of #{managementWF_MB.requestWF.wfId}:" class="p-emphasis"/>
                            <p:inputTextarea id="inputInformation" value="#{managementWF_MB.requestInfo}" />
                            <p:commandButton value="Send Request for Information">
                                <f:ajax listener="#{managementWF_MB.sendRequest()}" execute="@form" render="@form"/>
                            </p:commandButton>
                        </p:panel>
                    </p:dialog>
                    <p:panel rendered="#{managementWF_MB.searchBox}" styleClass="searchPanel">
                        <h:panelGrid columns="2" rendered="#{managementWF_MB.searchBox}" columnClasses="left,middle">
                            <p:outputLabel value="Workflow ID: " />
                            <p:inputText value="#{managementWF_MB.wfID}"/>
                            <p:outputLabel value="Workflow Object ID: " />
                            <p:inputText value="#{managementWF_MB.wfObjectID}" />
                            <p:outputLabel value="Comment 1:" />
                            <p:inputText value="#{managementWF_MB.wfComment1}" />
                            <p:outputLabel value="Comment 2:" />
                            <p:inputText value="#{managementWF_MB.wfComment2}" />
                            <p:outputLabel value="Comment 3:" />
                            <p:inputText value="#{managementWF_MB.wfComment3}" />
                            <p:outputLabel value="Comment 4:" />
                            <p:inputText value="#{managementWF_MB.wfComment4}" />
                        </h:panelGrid>
                    </p:panel>
                    <div class="panelButtons" style="display:#{(managementWF_MB.searchBox)?'block':'none'}">
                        <p:commandButton value="Search">
                            <f:ajax listener="#{managementWF_MB.searchWorkflows()}" execute="@form" render="@form"/>
                        </p:commandButton>
                    </div>
                    <p:dataTable value="#{managementWF_MB.listWF}" var="wf" emptyMessage="No workflow entries found." styleClass="resultPanel" selection="#{managementWF_MB.selectWF}" rowKey="#{wf.wfId}" scrollable="true" scrollHeight="600">
                        <f:facet name="header">
                            <p:outputPanel>
                                <h:outputText value="All workflow entries:" />
                            </p:outputPanel>
                        </f:facet>
                        <p:ajax event="rowSelect" update=":wfForm" />
                        <p:ajax event="rowUnselect" update=":wfForm" />
                        <p:ajax event="rowSelectCheckbox" update=":wfForm" />
                        <p:ajax event="rowUnselectCheckbox" update=":wfForm" />
                        <p:ajax event="rowUnselectCheckbox" update=":wfForm" />
                        <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                        <p:column headerText="Workflow ID" styleClass="small">
                            <p:commandLink id="ajax" update="wfForm" actionListener="#{managementWF_MB.showDetail(wf)}" oncomplete="PF('detailOverlay').show()" >
                                <h:outputText value="#{wf.wfId}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column headerText="Workflow Object Type : ID" styleClass="small">
                            <p:outputLabel value="#{wf.wfObjectName} : #{wf.wfObjectId}" />
                        </p:column>
                        <p:column headerText="Workflow Status" styleClass="small">
                            <p:outputLabel value="#{wf.wfStatus == 'O' ? 'Open' : wf.wfStatus == 'A' ? 'Approved' : wf.wfStatus == 'R' ? 'Rejected' : wf.wfStatus == 'I' ? 'Information Requested' : wf.wfStatus} as of #{wf.wfUpdatedDateTime == null ? wf.wfAddedDateTime : wf.wfUpdatedDateTime}"/>
                        </p:column>
                        <p:column headerText="Workflow Owner" styleClass="small">
                            <p:outputLabel value="#{wf.wfUserIdAdd.firstName} #{wf.wfUserIdAdd.lastName}"/>
                        </p:column>
                        <p:column headerText="Workflow Comments">
                            <p:outputLabel value="#{wf.wfComment1}"/><br />
                            <p:outputLabel value="#{wf.wfComment2}"/><br />
                            <p:outputLabel value="#{wf.wfComment3}"/><br />
                            <p:outputLabel value="#{wf.wfComment4}"/>
                        </p:column>
                        <p:column headerText="Approval Actions" styleClass="small">
                            <p:commandButton action="#{managementWF_MB.approveItem(wf)}" update="wfForm" disabled="#{wf.wfStatus != 'O' and wf.wfStatus != 'I'}" icon="fa fa-check" styleClass="approveButton"/> | 
                            <p:commandButton action="#{managementWF_MB.rejectItem(wf)}" update="wfForm" disabled="#{wf.wfStatus != 'O' and wf.wfStatus != 'I'}" icon="fa fa-times" styleClass="rejectButton"/> | 
                            <p:commandButton actionListener="#{managementWF_MB.requestItem(wf)}" oncomplete="PF('requestOverlay').show()" update="wfForm" disabled="#{wf.wfStatus != 'O' and wf.wfStatus != 'I'}" icon="fa fa-info" styleClass="requestButton"/>
                        </p:column>
                        <f:facet name="footer">
                            <p:outputPanel>
                                <h:outputText value="Selected #{managementWF_MB.selectWF.size()} #{managementWF_MB.selectWF.size() != 1 ? 'workflows' : 'workflow'}. " styleClass=""/>
                                <p:commandButton action="#{managementWF_MB.approveItems(managementWF_MB.selectWF)}" update="wfForm" icon="fa fa-check" styleClass="approveButton"/> | 
                                <p:commandButton action="#{managementWF_MB.rejectItems(managementWF_MB.selectWF)}" update="wfForm" icon="fa fa-times" styleClass="rejectButton"/>
                            </p:outputPanel>
                        </f:facet>
                    </p:dataTable>
                </h:form>
            </ui:define> 
        </ui:composition>
    </body>
</html>
