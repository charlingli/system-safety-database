<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../templates/masterTemplate.xhtml">
            <ui:define name="content">
                <h:form id="wfForm">
                    <ui:include src="../../templates/detailDialog.xhtml" />
                    <p:dialog id="wfDialog" header="Workflow Detail" widgetVar="wfOverlay" height="70vh" width="90vw" closeOnEscape="true">
                        <p:panel styleClass="detailHazardPanel">
                            <div class="p-heading-spacer">
                                <p:outputLabel styleClass="p-heading" value="Viewing details of the workflow:"/>
                            </div>
                            <p:panelGrid columns="4" class="detailTable" columnClasses="label,,label"> 
                                <p:outputLabel value="Workflow ID: "/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfId}"/>
                                <p:outputLabel value="Comment 1:"/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfComment1}"/>
                                <p:outputLabel value="Workflow Object Type &amp; Id "/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfObjectName}: #{userWF_MB.detailWF.wfObjectId}"/>
                                <p:outputLabel value="Comment 2:"/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfComment2}"/>
                                <p:outputLabel value="Workflow Status &amp; Last Update:"/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfStatus == 'O' ? 'Open' : userWF_MB.detailWF.wfStatus == 'A' ? 'Approved' : userWF_MB.detailWF.wfStatus == 'R' ? 'Rejected' : userWF_MB.detailWF.wfStatus == 'I' ? 'Open' : userWF_MB.detailWF.wfStatus} as of #{userWF_MB.detailWF.wfUpdatedDateTime == null ? userWF_MB.detailWF.wfAddedDateTime : userWF_MB.detailWF.wfUpdatedDateTime}"/>
                                <p:outputLabel value="Comment 3:"/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfComment3}"/>
                                <p:outputLabel value="Workflow Owner "/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfUserIdAdd.firstName} #{userWF_MB.detailWF.wfUserIdAdd.lastName}"/>
                                <p:outputLabel value="Comment 4:"/>
                                <p:outputLabel value="#{userWF_MB.detailWF.wfComment4}"/>
                            </p:panelGrid>
                        </p:panel>
                    </p:dialog>
                    <p:dataTable value="#{userWF_MB.listOpenWF}" id="openwfTable" widgetVar="wfTable" var="wf" emptyMessage="No workflow entries found." styleClass="resultPanel" selection="#{userWF_MB.selectWF}" rowSelectMode="checkbox" disabledSelection="#{wf.dbwfHeader.wfStatus == 'A' || wf.dbwfHeader.wfStatus == 'R'}" rowKey="#{wf.dbwfHeader.wfId}" scrollable="true" scrollHeight="400">
                        <f:facet name="header">
                            <p:outputPanel>
                                <h:outputText value="All workflow entries:"/>
                            </p:outputPanel>
                        </f:facet>
                        <p:ajax event="rowSelect" update=":wfForm"/>
                        <p:ajax event="rowUnselect" update=":wfForm"/>
                        <p:ajax event="rowSelectCheckbox" update=":wfForm"/>
                        <p:ajax event="rowUnselectCheckbox" update=":wfForm"/>
                        <p:ajax event="toggleSelect" update=":wfForm"/>
                        <p:column selectionMode="multiple" style="width: 2%; text-align:center"/>
                        <p:column headerText="Workflow ID" style="width: 7%; text-align:center">
                            <p:commandLink id="wfAjax" update="wfForm" actionListener="#{userWF_MB.showDetail(wf.dbwfHeader)}" oncomplete="PF('wfOverlay').show()">
                                <h:outputText value="#{wf.dbwfHeader.wfId}"/>
                            </p:commandLink>
                            <p:tooltip for="wfAjax">
                                <i class="fa fa-search"/>
                                <h:outputText value=" View Workflow"/>
                            </p:tooltip>
                        </p:column>
                        <p:column headerText="Workflow Object Type : ID" style="width: 11%; text-align:center">
                            <p:commandLink id="objAjax" update=":wfForm" actionListener="#{hazardDetail_MB.showDetail(wf.dbwfHeader.wfObjectId)}" oncomplete="PF('detailOverlay').show()">
                                <h:outputText value="#{wf.dbwfHeader.wfObjectName}: #{wf.dbwfHeader.wfObjectId}"/>
                            </p:commandLink>
                            <p:tooltip for="objAjax">
                                <i class="fa fa-search"/>
                                <h:outputText value=" View Hazard"/>
                            </p:tooltip>
                        </p:column>
                        <p:column headerText="Workflow Status" style="width: 16%; text-align:center">
                            <p:outputLabel value="#{wf.dbwfHeader.wfStatus == 'O' ? 'Open' : wf.dbwfHeader.wfStatus == 'A' ? 'Approved' : wf.dbwfHeader.wfStatus == 'R' ? 'Rejected' : wf.dbwfHeader.wfStatus == 'I' ? 'Information Requested' : wf.dbwfHeader.wfStatus} as of #{wf.dbwfHeader.wfUpdatedDateTime == null ? wf.dbwfHeader.wfAddedDateTime : wf.dbwfHeader.wfUpdatedDateTime}"/>
                        </p:column>
                        <p:column headerText="Workflow Owner" style="width: 8%; text-align:center">
                            <p:outputLabel value="#{wf.dbwfHeader.wfUserIdAdd.firstName} #{wf.dbwfHeader.wfUserIdAdd.lastName}"/>
                        </p:column>
                        <p:column headerText="Workflow Comments" style="width: 42%; text-align:left">
                            <p:outputLabel value="#{wf.dbwfHeader.wfComment1}"/><br />
                            <p:outputLabel value="#{wf.dbwfHeader.wfComment2}"/><br />
                            <p:outputLabel value="#{wf.dbwfHeader.wfComment3}"/><br />
                            <p:outputLabel value="#{wf.dbwfHeader.wfComment4}"/>
                        </p:column>
                        <p:column headerText="Approval Actions" style="width: 14%; text-align:center">
                            <p:commandButton id="approveButton" actionListener="#{userWF_MB.prepareDecision(wf, 'A')}" oncomplete="PF('singleOverlay').show('#{component.clientId}')" update="wfForm" icon="fa fa-check" styleClass="approveButton"/> 
                            <p:commandButton id="rejectButton" actionListener="#{userWF_MB.prepareDecision(wf, 'R')}" oncomplete="PF('singleOverlay').show('#{component.clientId}')" update="wfForm" icon="fa fa-ban" styleClass="rejectButton"/> 
                            <p:commandButton id="requestButton" actionListener="#{userWF_MB.prepareDecision(wf, 'I')}" oncomplete="PF('singleOverlay').show('#{component.clientId}')" update="wfForm" icon="fa fa-info" styleClass="requestButton" style="#{wf.dbwfHeader.wfCompleteMethod == 'HazardApprovalWF' ? '' : 'visibility: hidden'}" />
                            <p:tooltip for="approveButton">
                                <h:outputText value="Approve Workflow"/>
                            </p:tooltip>
                            <p:tooltip for="rejectButton">
                                <h:outputText value="Reject Workflow"/>
                            </p:tooltip>
                            <p:tooltip for="requestButton">
                                <h:outputText value="Request Information"/>
                            </p:tooltip>
                        </p:column>
                        <f:facet name="footer">
                            <p:outputPanel styleClass="tableFooter">
                                <div class="left">
                                    <h:outputText value="Selected #{userWF_MB.selectWF.size()} #{userWF_MB.selectWF.size() == 1 ? 'workflow' : userWF_MB.selectWF.size() == 0 ? 'workflows' : empty userWF_MB.selectWF ? 'no workflows' : 'workflows'}"/>
                                </div>
                                <div class="right">
                                    <h:outputText value="Bulk actions: " />
                                    <p:commandButton id="approveAllButton" action="#{userWF_MB.prepareDecisions('A')}" oncomplete="PF('multipleOverlay').show('#{component.clientId}')" update="wfForm" disabled="#{userWF_MB.selectWF.size() == 0 ? true : empty userWF_MB.selectWF ? true : false}" icon="fa fa-check" styleClass="approveButton"/> 
                                    <p:commandButton id="rejectAllButton" action="#{userWF_MB.prepareDecisions('R')}" oncomplete="PF('multipleOverlay').show('#{component.clientId}')" update="wfForm" disabled="#{userWF_MB.selectWF.size() == 0 ? true : empty userWF_MB.selectWF ? true : false}" icon="fa fa-ban" styleClass="rejectButton"/> 
                                    <p:commandButton id="reviewAllButton" action="#{userWF_MB.prepareDecisions('I')}" oncomplete="PF('multipleOverlay').show('#{component.clientId}')" update="wfForm" disabled="#{userWF_MB.selectWF.size() == 0 ? true : empty userWF_MB.selectWF ? true : userWF_MB.checkRequest() ? true : false}" icon="fa fa-info" styleClass="requestButton"/>
                                    <p:tooltip for="approveAllButton">
                                        <h:outputText value="Approve selected workflows"/>
                                    </p:tooltip>
                                    <p:tooltip for="rejectAllButton">
                                        <h:outputText value="Reject selected workflows"/>
                                    </p:tooltip>
                                    <p:tooltip for="reviewAllButton">
                                        <h:outputText value="Review selected workflows"/>
                                    </p:tooltip>
                                </div>
                            </p:outputPanel>
                        </f:facet>
                    </p:dataTable>
                    <p:overlayPanel widgetVar="singleOverlay" hideEffect="fade" dismissable="false" showCloseIcon="true">
                        <p:panelGrid columns="1" class="suggestionPanel">
                            <f:facet name="header">
                                <h:outputText value="#{userWF_MB.approvalDecision == 'A' ? 'Approve with comments' : userWF_MB.approvalDecision == 'R' ? 'Reject with comments' : userWF_MB.approvalDecision == 'I' ? 'Request for information' : userWF_MB.approvalDecision}"/>
                            </f:facet>
                            <h:outputText value="Leave a comment:"/>
                            <p:inputTextarea id="decisionComments" value="#{userWF_MB.approvalComment}"/>
                            <p:commandButton value="#{userWF_MB.approvalDecision == 'A' ? 'Approve' : userWF_MB.approvalDecision == 'R' ? 'Reject' : userWF_MB.approvalDecision == 'I' ? 'Request information' : userWF_MB.approvalDecision}" action="#{userWF_MB.sendDecision()}" update="wfForm"/>
                        </p:panelGrid>
                    </p:overlayPanel>
                    <p:overlayPanel widgetVar="multipleOverlay" hideEffect="fade" dismissable="false" showCloseIcon="true">
                        <p:panelGrid columns="1" class="suggestionPanel">
                            <f:facet name="header">
                                <h:outputText value="#{userWF_MB.approvalDecision == 'A' ? 'Approve all with comments' : userWF_MB.approvalDecision == 'R' ? 'Reject all with comments' : userWF_MB.approvalDecision == 'I' ? 'Request for information' : userWF_MB.approvalDecision}"/>
                            </f:facet>
                            <h:outputText value="Leave a comment:"/>
                            <p:inputTextarea id="decisionMultiple" value="#{userWF_MB.multipleComment}"/>
                            <p:commandButton value="#{userWF_MB.approvalDecision == 'A' ? 'Approve all' : userWF_MB.approvalDecision == 'R' ? 'Reject all' : userWF_MB.approvalDecision == 'I' ? 'Request information' : userWF_MB.approvalDecision}" action="#{userWF_MB.sendDecisions()}" update="wfForm"/>
                        </p:panelGrid>
                    </p:overlayPanel>
                </h:form>
            </ui:define> 
        </ui:composition>
    </body>
</html>
