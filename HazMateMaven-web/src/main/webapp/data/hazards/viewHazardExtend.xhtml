<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/default.css"/>
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/recssLayout.css"/>
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/hazMateStyle.css"/>
        <link rel="shortcut icon" href="#{resource['img/hazMateLogo.png']}" type="image/x-icon" />
        <title>HazMate Main Menu</title>
        <f:event type="preRenderView" listener="#{login_MB.validateSession()}" />
    </h:head>
    <body>
        <form jsf:id="hazardsForm" jsf:prependId="false">
            <p:messages autoUpdate="true" showDetail="true" showSummary="false"/>
            <div id="progress-modal" class="progress-back">
                <div class="progress-front">
                    <div class="loader">Loading...</div>
                </div>
            </div>
            <table class="extendTable">
                <thead>
                    <tr>
                        <th class="utilityHeader" colspan="27">
                            <div class="utilityDiv ui-g">
                                <div class="globalFilterDiv ui-g-6">
                                    <p>Global Filter:</p>
                                    <input type="text" id="gInput" onkeyup="globalFilter()" placeholder="Enter keyword" />
                                </div>
                                <div class="globalColumnsDiv ui-g-6">
                                    <p>Export Hazards:</p>
                                    <h:commandButton action="#{hazardViewExtend_MB.exportToFile}" value="As Excel" />
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr>
                        <th><p>Hazard ID</p></th>
                        <th><p>Hazard Description</p><input type="text" id="HDInput" onkeyup="filterRows()" /></th>
                        <th><p>Hazard SBS Code</p></th>
                        <th><p>Source Project</p>
                            <select id="SPInput" onchange="filterRows()">
                                <option value="">Source Projects</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listProjects}" var="SP" varStatus="status">
                                    <option value="#{SP.projectName}">#{SP.projectName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Source Location</p>
                            <select id="SLInput" onchange="filterRows()">
                                <option value="">Source Locations</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listLocations}" var="SL" varStatus="status">
                                    <option value="#{SL.locationName}">#{SL.locationName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Source Grade Separation</p>
                            <select id="SGInput" onchange="filterRows()">
                                <option value="">Source Grade Separation</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listGradeSeparations}" var="SG" varStatus="status">
                                    <option value="#{SG.gradeSeparationName}">#{SG.gradeSeparationName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Source Construction Type</p>
                            <select id="SNInput" onchange="filterRows()">
                                <option value="">Source Construction Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listConstructionTypes}" var="SN" varStatus="status">
                                    <option value="#{SN.constructionTypeName}">#{SN.constructionTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Source Change Type</p>
                            <select id="SHInput" onchange="filterRows()">
                                <option value="">Source Locations</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listChangeTypes}" var="SH" varStatus="status">
                                    <option value="#{SH.changeTypeName}">#{SH.changeTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Context</p>
                            <select id="HCInput" onchange="filterRows()">
                                <option value="">Hazard Context</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardContexts}" var="HC" varStatus="status">
                                    <option value="#{HC.hazardContextName}">#{HC.hazardContextName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Activity</p>
                            <select id="HAInput" onchange="filterRows()">
                                <option value="">Hazard Activity</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardActivities}" var="HA" varStatus="status">
                                    <option value="#{HA.activityName}">#{HA.activityName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Type</p>
                            <select id="HTInput" onchange="filterRows()">
                                <option value="">Hazard Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardTypes}" var="HT" varStatus="status">
                                    <option value="#{HT.hazardTypeName}">#{HT.hazardTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Owner</p>
                            <select id="HOInput" onchange="filterRows()">
                                <option value="">Hazard Owner</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardOwners}" var="HO" varStatus="status">
                                    <option value="#{HO.ownerName}">#{HO.ownerName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Causes</p><input type="text" id="CAInput" onkeyup="filterRows()" /></th>
                        <th><p>Hazard Consequences</p><input type="text" id="CQInput" onkeyup="filterRows()" /></th>
                        <th><p>Risk Category</p>
                            <select id="RCInput" onchange="filterRows()">
                                <option value="">Risk Category</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listRiskClasses}" var="RC" varStatus="status">
                                    <option value="#{RC.riskClassName}">#{RC.riskClassName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Risk Frequency</p></th>
                        <th><p>Risk Severity</p></th>
                        <th><p>Risk Score</p></th>
                        <th><p>Control Description</p><input type="text" id="CDInput" onkeyup="textFilter('CD')" /></th>
                        <th><p>Control Hierarchy</p>
                            <select id="CHInput" onchange="filterRows()">
                                <option value="">Control Hierarchy</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlHierarchies}" var="CH" varStatus="status">
                                    <option value="#{CH.controlHierarchyName}">#{CH.controlHierarchyName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Type</p>
                            <select id="CTInput" onchange="filterRows()">
                                <option value="">Control Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlTypes}" var="CT" varStatus="status">
                                    <option value="#{CT}">#{CT}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Owner</p>
                            <select id="COInput" onchange="filterRows()">
                                <option value="">Control Owner</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardOwners}" var="CO" varStatus="status">
                                    <option value="#{CO.ownerName}">#{CO.ownerName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Recommendation</p>
                            <select id="CRInput" onchange="filterRows()">
                                <option value="">Control Recommendation</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlRecommendations}" var="CR" varStatus="status">
                                    <option value="#{CR.controlRecommendName}">#{CR.controlRecommendName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Justification</p><input type="text" id="CJInput" onkeyup="filterRows()" /></th>
                        <th><p>Date of Entry</p></th>
                        <th><p>Workshop of Entry</p></th>
                        <th><p>Comments</p><input type="text" id="CMInput" onkeyup="filterRows()" /></th>
                    </tr>
                </thead>
                <tbody>
                    <ui:repeat value="#{hazardViewExtend_MB.hazardSearchedList}" var="hazard" varStatus="status">
                        <tr>
                            <td class="IDData"><h:outputText value="#{hazard.hazardId}" /></td>
                            <td class="HDData"><h:outputText value="#{hazard.hazardDescription}" /></td>
                            <td class="SCData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewSbsCondensed(hazard.hazardId)}" var="code">
                                        <tr>
                                            <td>
                                                <h:outputLink id="SCEntry" value="#"><h:outputText value="#{hazardViewExtend_MB.getNodeLastById(code)}"/></h:outputLink>
                                                <p:tooltip id="SCTooltip" for="SCEntry" value="#{hazardViewExtend_MB.getNodeNameById(code)}"/>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="SPData"><h:outputText value="#{hazard.hazardLocation.projectId.projectName}" /></td>
                            <td class="SLData"><h:outputText value="#{hazard.hazardLocation.locationName}" /></td>
                            <td class="SGData"><h:outputText value="#{hazard.hazardLocation.locationGradeSeparation.gradeSeparationName}" /></td>
                            <td class="SNData"><h:outputText value="#{hazard.hazardLocation.locationConstructionType.constructionTypeName}" /></td>
                            <td class="SHData"><h:outputText value="#{hazard.hazardLocation.locationChangeType.changeTypeName}" /></td>
                            <td class="HCData"><h:outputText value="#{hazard.hazardContextId.hazardContextName}" /></td>
                            <td class="HAData"><h:outputText value="#{hazard.hazardActivity.activityName}" /></td>
                            <td class="HTData"><h:outputText value="#{hazard.hazardTypeId.hazardTypeName}" /></td>
                            <td class="HOData"><h:outputText value="#{hazard.ownerId.ownerName}" /></td>
                            <td class="CAData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewHazardCause(hazard.hazardId)}" var="cause">
                                        <tr>
                                            <td>
                                                <h:outputText id="CAEntry" value="#{cause}" />
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CQData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewHazardConsequence(hazard.hazardId)}" var="consequence">
                                        <tr>
                                            <td>
                                                <h:outputText id="CQEntry" value="#{consequence}" />
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="RCData"><h:outputText value="#{hazard.riskClassId.riskClassName}" /></td>
                            <td class="RFData"><h:outputText value="#{hazard.riskFrequencyId.frequencyScore}" /></td>
                            <td class="RSData"><h:outputText value="#{hazard.riskSeverityId.severityScore}" /></td>
                            <td class="RRData"><h:outputText value="#{hazard.riskScore}" /></td>
                            <td class="CDData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlDescription(hazard.hazardId)}" var="CD">
                                        <tr>
                                            <td>
                                                <h:outputText id="CDEntry" value="#{CD}" />
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CHData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlHierarchy(hazard.hazardId)}" var="CH">
                                        <tr><td><h:outputText value="#{CH}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CTData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlType(hazard.hazardId)}" var="CT">
                                        <tr><td><h:outputText value="#{CT}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="COData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlOwner(hazard.hazardId)}" var="CO">
                                        <tr><td><h:outputText value="#{CO}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CRData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlRecommend(hazard.hazardId)}" var="CR">
                                        <tr><td><h:outputText value="#{CR}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CJData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlJustify(hazard.hazardId)}" var="CJ">
                                        <tr><td><h:outputText value="#{CJ}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="HEData"><h:outputText value="#{hazard.hazardDate}" /></td>
                            <td class="HWData"><h:outputText value="#{hazard.hazardWorkshop}" /></td>
                            <td class="HMData"><h:outputText value="#{hazard.hazardComment}" /></td>
                        </tr>
                    </ui:repeat>
                </tbody>
            </table> 
        </form>
    </body>
    <script src="../../resources/js/extendTableHeader.js" />
</html>
