<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/default.css"/>
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/recssLayout.css"/>
        <link rel="stylesheet" type="text/css" media="all" href="../../resources/css/hazMateStyle.css"/>
        <link rel="shortcut icon" href="#{resource['img/hazMateLogo.png']}" type="image/x-icon"/>
        <title>HazMate Main Menu</title>
        <f:event type="preRenderView" listener="#{login_MB.validateSession()}"/>
        <script type="text/javascript" src="../../resources/js/viewHazardExtend.js"/>
    </h:head>
    <body>
        <form jsf:id="hazardsForm" jsf:prependId="false">
            <p:messages autoUpdate="true" showDetail="true" showSummary="false"/>
            <div id="progress-modal" class="progress-back">
                <div class="progress-text">Loaded: <span id="nLoaded"></span><span id="nHazards">#{hazardViewExtend_MB.getnHazards()}</span></div>
                <div class="progress-front">
                    <div class="loader">Loading...</div>
                </div>
            </div>
            <p:dialog id="cDialog" header="Show/Hide Columns" widgetVar="cOverlay" height="500px" width="300px">
                <table>
                    <tbody>
                        <tr><td><input id="IDCheck" type="checkbox" onchange="toggleColumn('ID')"/>Hazard ID</td></tr>
                        <tr><td><input id="HDCheck" type="checkbox" onchange="toggleColumn('HD')"/>Hazard Description</td></tr>
                        <tr><td><input id="SCCheck" type="checkbox" onchange="toggleColumn('SC')"/>Hazard SBS Code</td></tr>
                        <tr><td><input id="SPCheck" type="checkbox" onchange="toggleColumn('SP')"/>Source Project</td></tr>
                        <tr><td><input id="SLCheck" type="checkbox" onchange="toggleColumn('SL')"/>Source Location</td></tr>
                        <tr><td><input id="SGCheck" type="checkbox" onchange="toggleColumn('SG')"/>Source Grade Separation</td></tr>
                        <tr><td><input id="SNCheck" type="checkbox" onchange="toggleColumn('SN')"/>Source Construction Type</td></tr>
                        <tr><td><input id="SHCheck" type="checkbox" onchange="toggleColumn('SH')"/>Source Change Type</td></tr>
                        <tr><td><input id="HCCheck" type="checkbox" onchange="toggleColumn('HC')"/>Hazard Context</td></tr>
                        <tr><td><input id="HACheck" type="checkbox" onchange="toggleColumn('HA')"/>Hazard Activity</td></tr>
                        <tr><td><input id="HTCheck" type="checkbox" onchange="toggleColumn('HT')"/>Hazard Type</td></tr>
                        <tr><td><input id="HOCheck" type="checkbox" onchange="toggleColumn('HO')"/>Hazard Owner</td></tr>
                        <tr><td><input id="CACheck" type="checkbox" onchange="toggleColumn('CA')"/>Hazard Causes</td></tr>
                        <tr><td><input id="CQCheck" type="checkbox" onchange="toggleColumn('CQ')"/>Hazard Consequences</td></tr>
                        <tr><td><input id="RCCheck" type="checkbox" onchange="toggleColumn('RC')"/>Risk Category</td></tr>
                        <tr><td><input id="RFCheck" type="checkbox" onchange="toggleColumn('RF')"/>Risk Frequency</td></tr>
                        <tr><td><input id="RSCheck" type="checkbox" onchange="toggleColumn('RS')"/>Risk Severity</td></tr>
                        <tr><td><input id="RRCheck" type="checkbox" onchange="toggleColumn('RR')"/>Risk Score</td></tr>
                        <tr><td><input id="CDCheck" type="checkbox" onchange="toggleColumn('CD')"/>Control Description</td></tr>
                        <tr><td><input id="CHCheck" type="checkbox" onchange="toggleColumn('CH')"/>Control Hierarchy</td></tr>
                        <tr><td><input id="CTCheck" type="checkbox" onchange="toggleColumn('CT')"/>Control Type</td></tr>
                        <tr><td><input id="COCheck" type="checkbox" onchange="toggleColumn('CO')"/>Control Owner</td></tr>
                        <tr><td><input id="CRCheck" type="checkbox" onchange="toggleColumn('CR')"/>Control Recommendation</td></tr>
                        <tr><td><input id="CJCheck" type="checkbox" onchange="toggleColumn('CJ')"/>Control Justification</td></tr>
                        <tr><td><input id="HECheck" type="checkbox" onchange="toggleColumn('HE')"/>Date of Entry</td></tr>
                        <tr><td><input id="HWCheck" type="checkbox" onchange="toggleColumn('HW')"/>Workshop of Entry</td></tr>
                        <tr><td><input id="HMCheck" type="checkbox" onchange="toggleColumn('HM')"/>Comments</td></tr>
                    </tbody>
                </table>
            </p:dialog>
            <table class="extendTable">
                <thead>
                    <tr>
                        <th class="utilityHeader" colspan="27">
                            <div class="utilityDiv ui-g">
                                <div class="globalFilterDiv ui-g-4">
                                    <p>Global Filter:</p>
                                    <input type="text" id="gInput" onkeyup="globalFilter()" placeholder="Enter keyword"/>
                                </div>
                                <div class="globalColumnsDiv ui-g-4">
                                    <p>Show/Hide Columms:</p>
                                    <button id="cButton" onclick="PF('cOverlay').show()" type="button">List columns</button>
                                </div>
                                <div class="globalExportDiv ui-g-4">
                                    <p>Export Hazards:</p>
                                    <h:commandButton action="#{hazardViewExtend_MB.testFunction()}" value="As .xls"/>
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr>
                        <th class="IDData"><p>Hazard ID</p></th>
                        <th class="HDData"><p>Hazard Description</p><input type="text" id="HDInput" onkeyup="filterRows()"/></th>
                        <th class="SCData"><p>Hazard SBS Code</p></th>
                        <th class="SPData"><p>Source Project</p>
                            <select id="SPInput" onchange="filterRows()">
                                <option value="">Source Projects</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listProjects}" var="SP" varStatus="status">
                                    <option value="#{SP.projectName}">#{SP.projectName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="SLData"><p>Source Location</p>
                            <select id="SLInput" onchange="filterRows()">
                                <option value="">Source Locations</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listLocations}" var="SL" varStatus="status">
                                    <option value="#{SL.locationName}">#{SL.locationName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="SGData"><p>Source Grade Separation</p>
                            <select id="SGInput" onchange="filterRows()">
                                <option value="">Source Grade Separation</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listGradeSeparations}" var="SG" varStatus="status">
                                    <option value="#{SG.gradeSeparationName}">#{SG.gradeSeparationName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="SNData"><p>Source Construction Type</p>
                            <select id="SNInput" onchange="filterRows()">
                                <option value="">Source Construction Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listConstructionTypes}" var="SN" varStatus="status">
                                    <option value="#{SN.constructionTypeName}">#{SN.constructionTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="SHData"><p>Source Change Type</p>
                            <select id="SHInput" onchange="filterRows()">
                                <option value="">Source Locations</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listChangeTypes}" var="SH" varStatus="status">
                                    <option value="#{SH.changeTypeName}">#{SH.changeTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="HCData"><p>Hazard Context</p>
                            <select id="HCInput" onchange="filterRows()">
                                <option value="">Hazard Context</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardContexts}" var="HC" varStatus="status">
                                    <option value="#{HC.hazardContextName}">#{HC.hazardContextName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="HAData"><p>Hazard Activity</p>
                            <select id="HAInput" onchange="filterRows()">
                                <option value="">Hazard Activity</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardActivities}" var="HA" varStatus="status">
                                    <option value="#{HA.activityName}">#{HA.activityName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th class="HTData"><p>Hazard Type</p>
                            <select id="HTInput" onchange="filterRows()">
                                <option value="">Hazard Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardTypes}" var="HT" varStatus="status">
                                    <option value="#{HT.hazardTypeName}">#{HT.hazardTypeName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Owner</p>
                            <select id="HOInput" onchange="filterRows()">
                                <option value="">Hazard Owner</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardOwners}" var="HO" varStatus="status">
                                    <option value="#{HO.ownerName}">#{HO.ownerName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Hazard Causes</p><input type="text" id="CAInput" onkeyup="filterRows()"/></th>
                        <th><p>Hazard Consequences</p><input type="text" id="CQInput" onkeyup="filterRows()"/></th>
                        <th><p>Risk Category</p>
                            <select id="RCInput" onchange="filterRows()">
                                <option value="">Risk Category</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listRiskClasses}" var="RC" varStatus="status">
                                    <option value="#{RC.riskClassName}">#{RC.riskClassName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Risk Frequency</p></th>
                        <th><p>Risk Severity</p></th>
                        <th><p>Risk Score</p></th>
                        <th><p>Control Description</p><input type="text" id="CDInput" onkeyup="filterRows('CD')"/></th>
                        <th><p>Control Hierarchy</p>
                            <select id="CHInput" onchange="filterRows()">
                                <option value="">Control Hierarchy</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlHierarchies}" var="CH" varStatus="status">
                                    <option value="#{CH.controlHierarchyName}">#{CH.controlHierarchyName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Type</p>
                            <select id="CTInput" onchange="filterRows()">
                                <option value="">Control Type</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlTypes}" var="CT" varStatus="status">
                                    <option value="#{CT}">#{CT}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Owner</p>
                            <select id="COInput" onchange="filterRows()">
                                <option value="">Control Owner</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listHazardOwners}" var="CO" varStatus="status">
                                    <option value="#{CO.ownerName}">#{CO.ownerName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Recommendation</p>
                            <select id="CRInput" onchange="filterRows()">
                                <option value="">Control Recommendation</option>
                                <ui:repeat value="#{hazardViewExtend_MB.listControlRecommendations}" var="CR" varStatus="status">
                                    <option value="#{CR.controlRecommendName}">#{CR.controlRecommendName}</option>
                                </ui:repeat>
                            </select> 
                        </th>
                        <th><p>Control Justification</p><input type="text" id="CJInput" onkeyup="filterRows()"/></th>
                        <th><p>Date of Entry</p></th>
                        <th><p>Workshop of Entry</p></th>
                        <th><p>Comments</p><input type="text" id="CMInput" onkeyup="filterRows()"/></th>
                    </tr>
                </thead>
                <tbody>
                    <ui:repeat value="#{hazardViewExtend_MB.hazardSearchedList}" var="hazard" varStatus="status">
                        <tr>
                            <td class="IDData"><h:outputText value="#{hazard.hazardId}"/></td>
                            <td class="HDData"><h:outputText value="#{hazard.hazardDescription}"/></td>
                            <td class="SCData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewSbsCondensed(hazard.hazardId)}" var="code">
                                        <tr >
                                            <td>
                                                <h:outputLink id="SCEntry" value="#"><h:outputText value="#{hazardViewExtend_MB.getNodeLastById(code)}"/></h:outputLink>
                                                <p:tooltip id="SCTooltip" for="SCEntry" value="#{hazardViewExtend_MB.getNodeNameById(code)}"/>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="SPData"><h:outputText value="#{hazard.hazardLocation.projectId.projectName}"/></td>
                            <td class="SLData"><h:outputText value="#{hazard.hazardLocation.locationName}"/></td>
                            <td class="SGData"><h:outputText value="#{hazard.hazardLocation.locationGradeSeparation.gradeSeparationName}"/></td>
                            <td class="SNData"><h:outputText value="#{hazard.hazardLocation.locationConstructionType.constructionTypeName}"/></td>
                            <td class="SHData"><h:outputText value="#{hazard.hazardLocation.locationChangeType.changeTypeName}"/></td>
                            <td class="HCData"><h:outputText value="#{hazard.hazardContextId.hazardContextName}"/></td>
                            <td class="HAData"><h:outputText value="#{hazard.hazardActivity.activityName}"/></td>
                            <td class="HTData"><h:outputText value="#{hazard.hazardTypeId.hazardTypeName}"/></td>
                            <td class="HOData"><h:outputText value="#{hazard.ownerId.ownerName}"/></td>
                            <td class="CAData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewHazardCause(hazard.hazardId)}" var="cause">
                                        <tr>
                                            <td>
                                                <h:outputText id="CAEntry" value="#{cause}"/>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CQData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewHazardConsequence(hazard.hazardId)}" var="consequence">
                                        <tr>
                                            <td>
                                                <h:outputText id="CQEntry" value="#{consequence}"/>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="RCData"><h:outputText value="#{hazard.riskClassId.riskClassName}"/></td>
                            <td class="RFData"><h:outputText value="#{hazard.riskFrequencyId.frequencyScore}"/></td>
                            <td class="RSData"><h:outputText value="#{hazard.riskSeverityId.severityScore}"/></td>
                            <td class="RRData"><h:outputText value="#{hazard.riskScore}"/></td>
                            <td class="CDData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlDescription(hazard.hazardId)}" var="CD">
                                        <tr>
                                            <td>
                                                <h:outputText id="CDEntry" value=" #{CD}"/>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CHData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlHierarchy(hazard.hazardId)}" var="CH">
                                        <tr><td><h:outputText value=" #{CH}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CTData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlType(hazard.hazardId)}" var="CT">
                                        <tr><td><h:outputText value=" #{CT}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="COData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlOwner(hazard.hazardId)}" var="CO">
                                        <tr><td><h:outputText value=" #{CO}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CRData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlRecommend(hazard.hazardId)}" var="CR">
                                        <tr><td><h:outputText value=" #{CR}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="CJData">
                                <table>
                                    <ui:repeat value="#{hazardViewExtend_MB.viewControlJustify(hazard.hazardId)}" var="CJ">
                                        <tr><td><h:outputText value=" #{CJ}"/></td></tr>
                                    </ui:repeat>
                                </table>
                            </td>
                            <td class="HEData"><h:outputText value="#{hazard.hazardDate}"/></td>
                            <td class="HWData"><h:outputText value="#{hazard.hazardWorkshop}"/></td>
                            <td class="HMData"><h:outputText value="#{hazard.hazardComment}"/></td>
                        </tr>
                        <script> 
                            nLoaded += 1;
                            nHazards = $("#nHazards").text();
                            $("#nLoaded").text((Math.round(nLoaded / parseFloat(nHazards) * 100)).toString() + "%");
                        </script>
                    </ui:repeat>
                </tbody>
            </table> 
        </form>
    </body>
</html>
