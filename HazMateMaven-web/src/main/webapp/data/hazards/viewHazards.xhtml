<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <body>
        <ui:composition template="./../../templates/masterTemplate.xhtml">
            <ui:define name="content">
                <h:form id="hazardsForm">
                    <div class="pagePath"><h:outputText value="#{pagePath_MB.pageHtmlPath}" escape="false"/></div>
                    <p:messages autoUpdate="true" showDetail="true" showSummary="false" severity="error, warn" closable="true" />
                    <p:growl autoUpdate="true" showDetail="true" showSummary="false" severity="info" />
                    <p:dialog id="statusDialog" width="120px" widgetVar="statusOverlay" draggable="false" closable="false" resizable="false" showHeader="false" style="min-width: 8em; min-height: 8em">
                        <div class="progress-back">
                            <div class="progress-front-1"></div>
                            <div class="progress-front-2"></div>
                            <div class="progress-front-3"></div>
                            <div class="progress-front-4"></div>
                        </div>
                    </p:dialog>
                    <p:dialog id="bowtieDialog" header="Bowtie Diagram" widgetVar="bowtieOverlay" height="70vh" width="90vw" closeOnEscape="true">
                        <p:panel class="visPanel">
                            <div class="visCanvas">
                                <div id="graphic"></div>
                                <div class="left">
                                    <ui:repeat value="${hazardViewVis_MB.selectedCauses}" var="CA" varStatus="status">
                                        <div>
                                            <h:outputText value="${CA.dbCause.causeDescription}"> </h:outputText>
                                        </div>
                                    </ui:repeat>
                                </div>
                                <div class="mid">
                                    <div>
                                        <h:outputText value="${hazardViewVis_MB.selectedDescription}"> </h:outputText>
                                        <div class="label">
                                            Targeted Risk:
                                        </div>
                                        <div class="risk">
                                            <div class="frequency">
                                                <h:outputText value="${hazardViewVis_MB.selectedHazard.riskFrequencyId.frequencyScore}"> </h:outputText>
                                            </div>
                                            <div class="severity">
                                                <h:outputText value="${hazardViewVis_MB.selectedHazard.riskSeverityId.severityScore}"> </h:outputText>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="right">
                                    <ui:repeat value="${hazardViewVis_MB.selectedConsequences}" var="CQ" varStatus="status">
                                        <div>
                                            <h:outputText value="${CQ.dbConsequence.consequenceDescription}"> </h:outputText>
                                        </div>
                                    </ui:repeat>
                                </div>
                                <div class="between">
                                    <div class="mid-left">
                                        <ui:repeat value="${hazardViewVis_MB.selectedPControls}" var="PC" varStatus="status">
                                            <div>
                                                <div class="marker"></div>
                                                <div class="text">
                                                    <h:outputLink id="PCEntry" value="#">
                                                        <h:outputText value="#{PC.dbControl.controlDescription}"/>
                                                    </h:outputLink>
                                                    <p:tooltip for="PCEntry" value="#{PC.dbControl.controlDescription}" trackMouse="true"/>
                                                </div>
                                                <div class="status">
                                                    <h:outputLink id="PCJustify" value="#">
                                                        <h:outputText value="#{PC.controlRecommendId.controlRecommendName}"/>
                                                    </h:outputLink>
                                                    <p:tooltip for="PCJustify" value="#{PC.controlJustify}" trackMouse="true"/>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                    <div class="mid-right">
                                        <ui:repeat value="${hazardViewVis_MB.selectedMControls}" var="MC" varStatus="status">
                                            <div>
                                                <div class="marker"></div>
                                                <div class="text">
                                                    <h:outputLink id="MCEntry" value="#">
                                                        <h:outputText value="#{MC.dbControl.controlDescription}"/>
                                                    </h:outputLink>
                                                    <p:tooltip for="MCEntry" value="#{MC.dbControl.controlDescription}" trackMouse="true"/>
                                                </div>
                                                <div class="status">
                                                    <h:outputLink id="MCJustify" value="#">
                                                        <h:outputText value="#{MC.controlRecommendId.controlRecommendName}"/>
                                                    </h:outputLink>
                                                    <p:tooltip for="MCJustify" value="#{MC.controlJustify}" trackMouse="true"/>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                    </div>
                                </div>
                            </div>
                        </p:panel>
                    </p:dialog>
                    <p:dialog id="detailDialog" header="Hazard Detail" widgetVar="detailOverlay" height="70vh" width="90vw" closeOnEscape="true">
                        <p:panel styleClass="detailHazardPanel">
                            <div class="p-heading-spacer">
                                <p:outputLabel styleClass="p-heading" value="Viewing details of the hazard:"/>
                            </div>
                            <p:panelGrid columns="2" class="detailTable" columnClasses="label"> 
                                <p:outputLabel value="ID: "/>
                                <p:outputLabel value="#{hazardView_MB.detailHazardId}"/>
                                <p:outputLabel value="Description: "/>
                                <p:outputLabel value="#{hazardView_MB.detailHazardDescription}"/>
                                <p:outputLabel value="Comments: "/>
                                <p:outputLabel value="#{hazardView_MB.detailHazardComment}"/>
                            </p:panelGrid>
                        </p:panel>
                        <p:panel id="hazardPanel" class="detailHazardPanel">
                            <div class="p-emphasis-spacer">
                                <h:outputText styleClass="p-emphasis" value="Hazard Information:"/>
                            </div>
                            <p:dataTable value="#{hazardView_MB.detailHazard}" emptyMessage="No hazards found.">
                                <p:column headerText="Activity" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardContextId.hazardContextName}"/>
                                </p:column>
                                <p:column headerText="Context" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardActivity.activityName}"/>
                                </p:column>
                                <p:column headerText="Type" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardTypeId.hazardTypeName}"/>
                                </p:column>
                                <p:column headerText="Status" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardStatusId.hazardStatusName}"/>
                                </p:column>
                                <p:column headerText="Owner" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.ownerId.ownerName}"/>
                                </p:column>
                            </p:dataTable>
                            <div class="p-emphasis-spacer">
                                <h:outputText styleClass="p-emphasis" value="Location Information:"/>
                            </div>
                            <p:dataTable value="#{hazardView_MB.detailHazard}" emptyMessage="No location details found.">
                                <p:column headerText="Project" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardLocation.projectId.projectName}"/>
                                </p:column>
                                <p:column headerText="Location" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardLocation.locationName}"/>
                                </p:column>
                                <p:column headerText="Grade Separation" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardLocation.locationGradeSeparation.gradeSeparationName}"/>
                                </p:column>
                                <p:column headerText="Construction Type" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardLocation.locationConstructionType.constructionTypeName}"/>
                                </p:column>
                                <p:column headerText="Change Type" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.hazardLocation.locationChangeType.changeTypeName}"/>
                                </p:column>
                            </p:dataTable>
                            <div class="p-emphasis-spacer">
                                <h:outputText styleClass="p-emphasis" value="Risk Information:"/>
                            </div>
                            <p:dataTable value="#{hazardView_MB.detailHazard}" emptyMessage="No risk details found.">
                                <p:column headerText="Class" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.riskClassId.riskClassName}"/>
                                </p:column>
                                <p:column headerText="Frequency" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.riskFrequencyId.frequencyScore}"/>
                                </p:column>
                                <p:column headerText="Severity" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.riskSeverityId.severityScore}"/>
                                </p:column>
                                <p:column headerText="Score" styleClass="small">
                                    <p:outputLabel value="#{hazardView_MB.detailHazard.riskScore}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <p:panel id="causePanel" class="detailHazardPanel">
                            <div class="p-emphasis-spacer">
                                <h:outputText styleClass="p-emphasis" value="The following causes are associated with the current hazard:"/>
                            </div>
                            <p:dataTable value="#{hazardView_MB.detailCauses}" var="CA" emptyMessage="No causes are associated with this hazard.">
                                <p:column headerText="ID" styleClass="small">
                                    <p:outputLabel value="#{CA.dbCause.causeId}"/>
                                </p:column>
                                <p:column headerText="Description" styleClass="normal">
                                    <p:outputLabel value="#{CA.dbCause.causeDescription}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <p:panel id="consequencePanel" styleClass="detailHazardPanel">
                            <h:outputText value="The following consequences are associated with the current hazard:" class="p-emphasis"/>
                            <p:dataTable value="#{hazardView_MB.detailConsequences}" var="CQ" emptyMessage="No consequences are associated with this hazard.">

                                <p:column headerText="ID" styleClass="small">
                                    <p:outputLabel value="#{CQ.dbConsequence.consequenceId}"/>
                                </p:column>
                                <p:column headerText="Description" styleClass="normal">
                                    <p:outputLabel value="#{CQ.dbConsequence.consequenceDescription}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <p:panel id="controlPanel" styleClass="detailHazardPanel">
                            <h:outputText value="The following controls are associated with the current hazard:" class="p-emphasis"/>
                            <p:dataTable value="#{hazardView_MB.detailControls}" var="CO" emptyMessage="No controls are associated with this hazard.">
                                <p:column headerText="ID" styleClass="small">
                                    <p:outputLabel value="#{CO.dbControl.controlId}"/>
                                </p:column>
                                <p:column headerText="Description" styleClass="normal">
                                    <p:outputLabel value="#{CO.dbControl.controlDescription}"/>
                                </p:column>
                                <p:column headerText="Owner" styleClass="small">
                                    <p:outputLabel value="#{CO.dbControl.ownerId.ownerName}"/>
                                </p:column>
                                <p:column headerText="Hierarchy" styleClass="small">
                                    <p:outputLabel value="#{CO.dbControl.controlHierarchyId.controlHierarchyName}"/>
                                </p:column>
                                <p:column headerText="Type" styleClass="small">
                                    <p:outputLabel value="#{CO.controlType == 'P' ? 'Preventive' : CO.controlType == 'M' ? 'Mitigative' : CO.controlType}"/>
                                </p:column>
                                <p:column headerText="Recommendation" styleClass="small">
                                    <p:outputLabel value="#{CO.controlRecommendId.controlRecommendName}"/>
                                </p:column>
                                <p:column headerText="Justification" styleClass="normal">
                                    <p:outputLabel value="#{CO.controlJustify}"/>
                                </p:column>
                                <p:column headerText="Status" styleClass="small">
                                    <p:outputLabel value="#{CO.controlExistingOrProposed == 'P' ? 'Proposed' : CO.controlExistingOrProposed == 'E' ? 'Existing' : CO.controlExistingOrProposed}"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:dialog>
                    <p:fieldset id="fieldset" legend="Search parameters" toggleable="true" toggleSpeed="1000" styleClass="searchFieldset" collapsed="true">
                        <h:panelGrid columns="2" columnClasses="fields,explanation">
                            <p:accordionPanel id="searchFields" multiple="true" class="searchAccordion" activeIndex="null">
                                <p:tab title="Hazard Fields">
                                    <p:panel styleClass="searchPanel">
                                        <p:panelGrid columns="3" columnClasses="left,middle,right">
                                            <p:outputLabel>Hazard Id:</p:outputLabel>
                                            <p:inputText id="HiDInput" value="#{hazardView_MB.searchedHazardId}">
                                                <p:ajax event="keyup" update="HiDClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HiDClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedHazardId}">
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Description:</p:outputLabel>
                                            <p:inputText id="HDInput" value="#{hazardView_MB.searchedHazardDescription}">
                                                <p:ajax event="keyup" update="HDClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HDClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedHazardDescription}">
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Causes:</p:outputLabel>
                                            <p:inputText id="CAInput" value="#{hazardView_MB.searchedCauses}">
                                                <p:ajax event="keyup" update="CAClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CAClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedCauses}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Consequences:</p:outputLabel>
                                            <p:inputText id="CQInput" value="#{hazardView_MB.searchedConsequences}">
                                                <p:ajax event="keyup" update="CQClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CQClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedConsequences}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Comments:</p:outputLabel>
                                            <p:inputText id="HMInput" value="#{hazardView_MB.searchedHazardComments}">
                                                <p:ajax event="keyup" update="HMClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HMClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedHazardComments}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Legacy Id:</p:outputLabel>
                                            <p:inputText id="HLiDInput" value="#{hazardView_MB.searchedLegacyId}">
                                                <p:ajax event="keyup" update="HLiDClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HLiDClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedLegacyId}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Location:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HLInput" value="#{hazardView_MB.selectedLocations}" label="Hazard Locations" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listLocations}" var="location" itemLabel="#{location.locationName}" itemValue="#{location.locationId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HLClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedLocations}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Project:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HPInput" value="#{hazardView_MB.selectedProjects}" label="Hazard Projects" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listProjects}" var="project" itemLabel="#{project.projectName}" itemValue="#{project.projectId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HPClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedProjects}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Grade Separation:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="GSInput" value="#{hazardView_MB.selectedGradeSeparations}" label="Grade Separations" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listGradeSeparations}" var="gradeSeparation" itemLabel="#{gradeSeparation.gradeSeparationName}" itemValue="#{gradeSeparation.gradeSeparationId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="GSClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedGradeSeparations}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Construction Type:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="CNInput" value="#{hazardView_MB.selectedConstructionTypes}" label="Construction Types" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listConstructionTypes}" var="constructionType" itemLabel="#{constructionType.constructionTypeName}" itemValue="#{constructionType.constructionTypeId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CNClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedConstructionTypes}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Change Type:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="CHInput" value="#{hazardView_MB.selectedChangeTypes}" label="Change Types" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listChangeTypes}" var="changeType" itemLabel="#{changeType.changeTypeName}" itemValue="#{changeType.changeTypeId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CHClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedChangeTypes}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Activity:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HAInput" value="#{hazardView_MB.selectedHazardActivities}" label="Hazard Activities" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardActivities}" var="hazardActivity" itemLabel="#{hazardActivity.activityName}" itemValue="#{hazardActivity.activityId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HAClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedHazardActivities}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Context:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HCInput" value="#{hazardView_MB.selectedHazardContexts}" label="Hazard Contexts" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardContexts}" var="hazardContext" itemLabel="#{hazardContext.hazardContextName}" itemValue="#{hazardContext.hazardContextId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HCClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedHazardContexts}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Type:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HTInput" value="#{hazardView_MB.selectedHazardTypes}" label="Hazard Types" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardTypes}" var="hazardType" itemLabel="#{hazardType.hazardTypeName}" itemValue="#{hazardType.hazardTypeId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HTClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedHazardTypes}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Status:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HSInput" value="#{hazardView_MB.selectedHazardStatuses}" label="Hazard Statuses" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardStatuses}" var="hazardStatus" itemLabel="#{hazardStatus.hazardStatusName}" itemValue="#{hazardStatus.hazardStatusId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HSClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedHazardStatuses}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Hazard Owner:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="HOInput" value="#{hazardView_MB.selectedHazardOwners}" label="Hazard Owners" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardOwners}" var="hazardOwner" itemLabel="#{hazardOwner.ownerName}" itemValue="#{hazardOwner.ownerId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="HOClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedHazardOwners}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                        </p:panelGrid>
                                    </p:panel>
                                </p:tab>
                                <p:tab title="System Breakdown Structure Codes">
                                    <p:tree value="#{trees_MB.root}" var="doc"
                                            selectionMode="checkbox"
                                            selection="#{hazardView_MB.TNSelectedNodes}">
                                        <p:treeNode>
                                            <h:outputText value="#{doc}"/>
                                        </p:treeNode>
                                    </p:tree>
                                </p:tab>
                                <p:tab title="Control Fields">
                                    <p:panel styleClass="searchPanel">
                                        <p:panelGrid columns="3" columnClasses="left,middle,right">
                                            <p:outputLabel>Control Description:</p:outputLabel>
                                            <p:inputText value="#{hazardView_MB.searchedControlDescription}">
                                                <p:ajax event="keyup" update="CDClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CDClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedControlDescription}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Control Justification:</p:outputLabel>
                                            <p:inputText value="#{hazardView_MB.searchedControlJustification}">
                                                <p:ajax event="keyup" update="CJClear"/>
                                            </p:inputText>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CJClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.searchedControlJustification}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Control Hierarchy:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="CHMenu" value="#{hazardView_MB.selectedControlHierachies}" label="Hierarchy" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listControlHierarchies}" var="controlHier" itemLabel="#{controlHier.controlHierarchyName}" itemValue="#{controlHier.controlHierarchyId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CTClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedControlHierachies}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Control Owner:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="COMenu" value="#{hazardView_MB.selectedControlOwners}" label="Owners" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listHazardOwners}" var="controlOwner" itemLabel="#{controlOwner.ownerName}" itemValue="#{controlOwner.ownerId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="COClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedControlOwners}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <p:outputLabel>Control Recommendation:</p:outputLabel>
                                            <p:selectCheckboxMenu class="searchInput" id="CRMenu" value="#{hazardView_MB.selectedControlRecommendations}" label="Recommendations" filter="true" filterMatchMode="contains">
                                                <f:selectItems value="#{hazardView_MB.listControlRecommendations}" var="controlRecommendation" itemLabel="#{controlRecommendation.controlRecommendName}" itemValue="#{controlRecommendation.controlRecommendId}"/>
                                            </p:selectCheckboxMenu>
                                            <h:panelGroup styleClass="remove">
                                                <p:commandLink id="CRClear" update="hazardsForm" action="#{hazardView_MB.clearField(component.id)}" process="@this" rendered="#{not empty hazardView_MB.selectedControlRecommendations}"> 
                                                    <i class="fa fa-remove"/>
                                                </p:commandLink>
                                            </h:panelGroup>
                                        </p:panelGrid>
                                    </p:panel>
                                </p:tab>
                                <p:tab title="Data Quality">
                                    <p:panel styleClass="searchPanel">
                                        <p:panelGrid columns="3" columnClasses="left,middle,right">
                                            <p:outputLabel for="dataQuality" value="Hazard Quality:" />
                                            <p:selectOneRadio id="dataQuality" value="#{hazardView_MB.hazardsQuality}" layout="grid" columns="1">
                                                <f:selectItem id="allHazardsOption" itemLabel="All hazards" itemValue="A" />
                                                <f:selectItem id="completeHazardsOption" itemLabel="Complete hazards" itemValue="C" />
                                                <f:selectItem id="incompleteHazardsOption" itemLabel="Incomplete hazards" itemValue="I" />
                                            </p:selectOneRadio>
                                        </p:panelGrid>  
                                    </p:panel>
                                </p:tab>
                            </p:accordionPanel>
                            <p:panel styleClass="queryDescr" visible="#{hazardView_MB.enableQueryDescr}">
                                <h:outputText value="#{hazardView_MB.htmlCode}" escape="false"/>
                            </p:panel>
                        </h:panelGrid>
                    </p:fieldset>
                    <div class="panelButtons">
                        <p:commandButton value="Search Hazards" action="#{hazardView_MB.constructSearchObject()}" update="hazardsForm" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()" />
                        <p:commandButton value="Reset Fields" update="hazardsForm" process="@this" action="#{hazardView_MB.resetFields()}">
                            <p:resetInput target="hazardsForm"/>
                        </p:commandButton>
                    </div>
                    <p:dataTable id="hazardsTable" value="#{hazardView_MB.listSearchedHazards}" var="hazard" emptyMessage="No hazard entries found with given criteria. Adjust parameters and click 'Search Hazards' to begin." 
                                 scrollable="true" scrollHeight="600" scrollRows="100" liveScroll="true" styleClass="resultPanel" rowIndexVar="rowIndex" rowKey="#{hazard.hazardObj.hazardId}" selection="#{hazardView_MB.checkedHazards}" rowSelectMode="checkbox">
                        <f:facet name="header">
                            <p:outputPanel styleClass="tableHeader">
                                <div class="left"></div>
                                <div class="center">
                                    <h:outputText value="The current hazards are: "/>
                                </div>
                                <div class="right">
                                    <h:outputText value="Export #{hazardView_MB.checkedHazards.size()} #{hazardView_MB.checkedHazards.size() == 1 ? 'hazard' : hazardView_MB.checkedHazards.size() == 0 ? 'hazards' : empty hazardView_MB.checkedHazards ? 'no hazards' : 'hazards'}: "/>
                                    <p:commandButton id="exportButton" actionListener="#{hazardView_MB.getIdsForExport()}" disabled="#{hazardView_MB.checkedHazards.size() == 0 ? true : empty hazardView_MB.checkedHazards ? true : false}" icon="fa fa-download" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/> 
                                </div>
                            </p:outputPanel>
                        </f:facet>
                        <p:ajax event="rowSelect" update="hazardsForm:hazardsTable" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/>
                        <p:ajax event="rowUnselect" update="hazardsForm:hazardsTable" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/>
                        <p:ajax event="rowSelectCheckbox" update="hazardsForm:hazardsTable" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/>
                        <p:ajax event="rowUnselectCheckbox" update="hazardsForm:hazardsTable" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/>
                        <p:ajax event="toggleSelect" update="hazardsForm:hazardsTable" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide()"/>
                        <p:column selectionMode="multiple" style="width: 2%; text-align:center"/>
                        <p:column style="width: 5%; text-align:center">
                            <f:facet name="header">
                                <h:outputText value="Visualise"/>
                            </f:facet>
                            <p:commandButton action="#{hazardViewVis_MB.constructObject(hazard.hazardObj.hazardId)}" update="hazardsForm" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide(); PF('bowtieOverlay').show(); buildVis();" icon="fa fa-sitemap" disabled="#{empty hazard.missingInfo ? false : hazard.missingInfo}"/>
                        </p:column>
                        <p:column style="width: 7%; text-align:center" headerText="Rate &amp; Tag">
                            <h:outputText>
                                <f:event type="preRenderComponent" listener="#{hazardView_MB.setQualityRating(hazardView_MB.getHazardRating(hazard.hazardObj.hazardId))}" />
                            </h:outputText>
                            <p:rating value="#{hazardView_MB.qualityRating}" stars="3" >
                                <p:ajax event="rate" listener="#{hazardView_MB.rateHazard(hazard.hazardObj.hazardId, hazardView_MB.qualityRating)}" update="hazardsForm:hazardsTable:#{rowIndex}:averageRating, hazardsForm:hazardsTable:#{rowIndex}:countRating, hazardsForm:hazardsTable:#{rowIndex}:averageTooltip, hazardsForm:hazardsTable:#{rowIndex}:countTooltip">
                                    <f:attribute name="hazardId" value="#{hazard.hazardObj}" />
                                </p:ajax>
                                <p:ajax event="cancel" listener="#{hazardView_MB.rateHazard(hazard.hazardObj.hazardId, 0)}" update="hazardsForm:hazardsTable:#{rowIndex}:averageRating, hazardsForm:hazardsTable:#{rowIndex}:countRating" />
                            </p:rating>
                            <p:commandLink id="averageRating">
                                <h:outputText value="#{empty hazard.sumOfRateTimesWeighting ? 'N/A' : hazardView_MB.getRatingScore(hazard.sumOfRateTimesWeighting, hazard.sumOfWeight)}"/>
                            </p:commandLink> |
                            <p:commandLink id="countRating">
                                <h:outputText value="#{hazard.rateCount}"/>
                            </p:commandLink>
                            <br />
                            <p:commandButton id="missingButton" action="#{hazardViewVis_MB.constructObject(hazard.hazardObj.hazardId)}" rendered="#{empty hazard.missingInfo ? false : hazard.missingInfo}" icon="fa fa-question" styleClass="missingButton"/>
                            <p:menuButton icon="fa fa-tag" id="tagButton">
                                <p:menuitem id="suggestionButton" value="Suggest a change" actionListener="#{hazardView_MB.setDetailHazard(hazard.hazardObj)}" oncomplete="PF('suggestionOverlay').show('#{component.clientId}')" icon="fa fa-pencil"/>
                                <p:menuitem id="deletionButton" value="Mark for deletion" actionListener="#{hazardView_MB.setDetailHazard(hazard.hazardObj)}" oncomplete="PF('deletionOverlay').show('#{component.clientId}')" icon="fa fa-trash"/>
                            </p:menuButton>
                            <p:tooltip id="averageTooltip" for="averageRating">
                                <h:outputText value="Average rating"/>
                            </p:tooltip>
                            <p:tooltip id="countTooltip" for="countRating">
                                <h:outputText value="Number of ratings"/>
                            </p:tooltip>
                            <p:tooltip for="tagButton">
                                <h:outputText value="Tag a change or mark for deletion"/>
                            </p:tooltip>
                            <p:tooltip for="missingButton">
                                <h:outputText value="This hazard is missing information!"/>
                            </p:tooltip>
                        </p:column>
                        <p:column style="width: 7%; text-align:center">
                            <f:facet name="header">
                                <h:outputText value="Hazard ID"/>
                            </f:facet>
                            <p:commandLink id="viewLink" update="hazardsForm" actionListener="#{hazardView_MB.showDetail(hazard.hazardObj.hazardId)}" onstart="PF('statusOverlay').show()" oncomplete="PF('statusOverlay').hide(); PF('detailOverlay').show()">
                                <h:outputText value="#{hazard.hazardObj.hazardId}"/>
                            </p:commandLink>
                            <p:tooltip for="viewLink">
                                <i class="fa fa-search"/>
                                <h:outputText value=" View Hazard"/>
                            </p:tooltip>
                        </p:column>
                        <p:column style="width: 23%">
                            <f:facet name="header">
                                <h:outputText value="Description"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardDescription}"/>
                        </p:column>
                        <p:column style="width: 23%">
                            <f:facet name="header">
                                <h:outputText value="Comment"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardComment}"/>
                        </p:column>
                        <p:column style="width: 6%">
                            <f:facet name="header">
                                <h:outputText value="Context"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardContextId.hazardContextName}"/>
                        </p:column>
                        <p:column style="width: 6.5%">
                            <f:facet name="header">
                                <h:outputText value="Location"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardLocation.locationName}"/>
                        </p:column>
                        <p:column style="width: 7%">
                            <f:facet name="header">
                                <h:outputText value="Activity"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardActivity.activityName}"/>
                        </p:column>
                        <p:column style="width: 6%">
                            <f:facet name="header">
                                <h:outputText value="Type"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardTypeId.hazardTypeName}"/>
                        </p:column>
                        <p:column style="width: 6.5%">
                            <f:facet name="header">
                                <h:outputText value="Status"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.hazardStatusId.hazardStatusName}"/>
                        </p:column>
                        <p:column style="width: 7%">
                            <f:facet name="header">
                                <h:outputText value="Owner"/>
                            </f:facet>
                            <h:outputText value="#{hazard.hazardObj.ownerId.ownerName}"/>
                        </p:column>
                        <f:facet name="footer">
                            <p:outputPanel>
                                <h:outputText value="Showing #{hazardView_MB.listSearchedHazards.size()} #{hazardView_MB.listSearchedHazards.size() == 1 ? 'hazard' : hazardView_MB.listSearchedHazards.size() == 0 ? 'hazards' : empty hazardView_MB.listSearchedHazards ? 'no hazards' : 'hazards'}"/>
                            </p:outputPanel>
                        </f:facet>
                    </p:dataTable>
                    <p:overlayPanel widgetVar="suggestionOverlay" hideEffect="fade" dismissable="false" showCloseIcon="true">
                        <p:panelGrid columns="1" class="suggestionPanel">
                            <f:facet name="header">
                                <h:outputText value="Suggest a change"/>
                            </f:facet>
                            <h:outputText value="Leave a comment:"/>
                            <p:inputTextarea id="suggestionComments" value="#{hazardView_MB.suggestionComment}"/>
                            <p:commandButton value="Send" actionListener="#{hazardView_MB.sendSuggestion()}" update="suggestionComments" oncomplete="PF('suggestionOverlay').hide()" />
                        </p:panelGrid>
                    </p:overlayPanel>
                    <p:overlayPanel widgetVar="deletionOverlay" hideEffect="fade" dismissable="false" showCloseIcon="true">
                        <p:panelGrid columns="1" class="suggestionPanel">
                            <f:facet name="header">
                                <h:outputText value="Mark for deletion"/>
                            </f:facet>
                            <h:outputText value="Leave a comment:"/>
                            <p:inputTextarea id="deletionComments" value="#{hazardView_MB.deletionComment}"/>
                        </p:panelGrid>
                        <p:panelGrid columns="2" class="suggestionPanel">
                            <p:selectOneMenu id="deletionReason" value="#{hazardView_MB.deletionReason}">
                                <f:selectItem itemLabel="Duplicate" itemValue="Duplicate" />
                                <f:selectItem itemLabel="Poor Quality" itemValue="Poor Quality" />
                                <f:selectItem itemLabel="Other (see comment)" itemValue="Other (see comment)" />
                            </p:selectOneMenu>
                            <p:commandButton value="Send" actionListener="#{hazardView_MB.sendDeletion()}" update="deletionComments, deletionReason" oncomplete="PF('deletionOverlay').hide()" />
                        </p:panelGrid>
                    </p:overlayPanel>
                </h:form>
                <script type="text/javascript" src="../../resources/js/svg.min.js"/>
                <script type="text/javascript" src="../../resources/js/viewVis.js"/>
            </ui:define>
        </ui:composition>
    </body>
</html>
