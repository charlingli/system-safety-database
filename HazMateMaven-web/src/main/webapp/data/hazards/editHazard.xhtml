<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <body>
        <ui:composition template="./../../templates/masterTemplate.xhtml">
            <ui:define name="content">
                <f:view>
                    <h:form id="form">
                        <div class="pagePath"><h:outputText value="#{pagePath_MB.pageHtmlPath}" escape="false"/></div>
                        <p:messages autoUpdate="true" showDetail="true" showSummary="false" severity="error, warn" closable="true" />
                        <p:growl autoUpdate="true" showDetail="true" showSummary="false" severity="info" />
                        <p:fieldset id="fieldset" rendered="#{not editHazard_MB.showEdit}" legend="Search parameters" toggleable="true" toggleSpeed="1000" styleClass="searchFieldset" collapsed="true">
                            <h:panelGrid columns="2" columnClasses="fields,explanation">
                                <p:panel styleClass="searchPanel" style="width: 500px;">
                                    <p:panelGrid columns="3" columnClasses="left,middle,right">
                                        <p:outputLabel>Hazard ID</p:outputLabel>
                                        <p:inputText id="HIInput" value="#{editHazard_MB.searchHI}" class="searchInput" />
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HIClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHI}">
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Date</p:outputLabel>
                                        <p:calendar id="DTInput" inputStyleClass="searchInput" value="#{editHazard_MB.searchDT}" title="HazardDate1" maxdate="#{addHazard_MB.todaysDate()}" />
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="DTClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchDT}">
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Description:</p:outputLabel>
                                        <p:inputText id="HDInput" value="#{editHazard_MB.searchHD}" class="searchInput" />
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HDClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHD}">
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Comments:</p:outputLabel>
                                        <p:inputText id="HMInput" value="#{editHazard_MB.searchHM}" class="searchInput" />
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HMClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHM}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Location:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HLInput" value="#{editHazard_MB.searchHL}" label="Hazard Locations" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHL}" var="location" itemLabel="#{location.locationName}" itemValue="#{location.locationId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HLClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHL}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Project:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HPInput" value="#{editHazard_MB.searchHP}" label="Hazard Projects" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHP}" var="project" itemLabel="#{project.projectName}" itemValue="#{project.projectId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HPClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHP}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Grade Separation:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="GSInput" value="#{editHazard_MB.searchGS}" label="Grade Separations" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listGS}" var="gradeSeparation" itemLabel="#{gradeSeparation.gradeSeparationName}" itemValue="#{gradeSeparation.gradeSeparationId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="GSClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchGS}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Construction Type:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="CNInput" value="#{editHazard_MB.searchCN}" label="Construction Types" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listCN}" var="constructionType" itemLabel="#{constructionType.constructionTypeName}" itemValue="#{constructionType.constructionTypeId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="CNClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchCN}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Change Type:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="CHInput" value="#{editHazard_MB.searchCH}" label="Change Types" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listCH}" var="changeType" itemLabel="#{changeType.changeTypeName}" itemValue="#{changeType.changeTypeId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="CHClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchCH}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Activity:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HAInput" value="#{editHazard_MB.searchHA}" label="Hazard Activities" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHA}" var="hazardActivity" itemLabel="#{hazardActivity.activityName}" itemValue="#{hazardActivity.activityId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HAClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHA}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Context:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HCInput" value="#{editHazard_MB.searchHC}" label="Hazard Contexts" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHC}" var="hazardContext" itemLabel="#{hazardContext.hazardContextName}" itemValue="#{hazardContext.hazardContextId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HCClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHC}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Type:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HTInput" value="#{editHazard_MB.searchHT}" label="Hazard Types" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHT}" var="hazardType" itemLabel="#{hazardType.hazardTypeName}" itemValue="#{hazardType.hazardTypeId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HTClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHT}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Status:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HSInput" value="#{editHazard_MB.searchHS}" label="Hazard Statuses" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHS}" var="hs" itemLabel="#{hs.hazardStatusName}" itemValue="#{hs.hazardStatusId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HSClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHS}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel>Hazard Owner:</p:outputLabel>
                                        <p:selectCheckboxMenu class="searchInput" id="HOInput" value="#{editHazard_MB.searchHO}" label="Hazard Owners" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listHO}" var="ho" itemLabel="#{ho.ownerName}" itemValue="#{ho.ownerId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup styleClass="remove">
                                            <p:commandLink id="HOClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchHO}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <p:outputLabel rendered="#{editHazard_MB.adminUser}">System Status:</p:outputLabel>
                                        <p:selectCheckboxMenu rendered="#{editHazard_MB.adminUser}" class="searchInput" id="SSInput" value="#{editHazard_MB.searchSS}" label="System Status" filter="true" filterMatchMode="contains">
                                            <f:selectItems value="#{editHazard_MB.listSS}" var="ss" itemLabel="#{ss.systemStatusName}" itemValue="#{ss.systemStatusId}"/>
                                        </p:selectCheckboxMenu>
                                        <h:panelGroup rendered="#{editHazard_MB.adminUser}" styleClass="remove">
                                            <p:commandLink id="SSClear" update="form" action="#{editHazard_MB.clearField(component.id)}" process="@this" rendered="#{not empty editHazard_MB.searchSS}"> 
                                                <i class="fa fa-remove"/>
                                            </p:commandLink>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </p:panel>
                                <p:panel styleClass="queryDescr" visible="#{editHazard_MB.showQuery}">
                                    <h:outputText value="#{editHazard_MB.htmlCode}" escape="false"/>
                                </p:panel>
                            </h:panelGrid>
                        </p:fieldset>
                        <div class="panelButtons" style="display: #{(not editHazard_MB.showEdit) ? 'block' : 'none'}">
                            <p:commandButton value="Search Hazards">
                                <f:ajax listener="#{editHazard_MB.constructSearchObject()}" execute="@form" render="@form"/>
                            </p:commandButton> 
                            <p:commandButton value="Reset Fields" update="form" process="@this" action="#{editHazard_MB.resetFields()}">
                                <p:resetInput target="form"/>
                            </p:commandButton>
                        </div>
                        <p:dataTable id="viewTable" rendered="#{not editHazard_MB.showEdit}" value="#{editHazard_MB.listHazards}" var="item" paginator="true" rows="25" paginatorPosition="bottom" styleClass="resultPanel" emptyMessage="No hazards found.">
                            <f:facet name="header">
                                <p:outputPanel>
                                    <h:outputText value="Select from the following hazards: "/>
                                </p:outputPanel>
                            </f:facet>
                            <p:column style="width: 7%; text-align:center" headerText="Hazard ID">
                                <h:outputText value="#{item.hazardId}"/>
                            </p:column>
                            <p:column style="width: 23%" headerText="Description">
                                <h:outputText value="#{item.hazardDescription}"/>
                            </p:column>
                            <p:column style="width: 23%" headerText="Comment">
                                <h:outputText value="#{item.hazardComment}"/>
                            </p:column>
                            <p:column style="width: 6%" headerText="Context">
                                <h:outputText value="#{item.hazardContextId.hazardContextName}"/>
                            </p:column>
                            <p:column style="width: 6.5%" headerText="Location">
                                <h:outputText value="#{item.hazardLocation.locationName}"/>
                            </p:column>
                            <p:column style="width: 7%" headerText="Activity">
                                <h:outputText value="#{item.hazardActivity.activityName}"/>
                            </p:column>
                            <p:column style="width: 6%" headerText="Type">
                                <h:outputText value="#{item.hazardTypeId.hazardTypeName}"/>
                            </p:column>
                            <p:column style="width: 6.5%" headerText="Status">
                                <h:outputText value="#{item.hazardStatusId.hazardStatusName}"/>
                            </p:column>
                            <p:column style="width: 7%" headerText="Owner">
                                <h:outputText value="#{item.ownerId.ownerName}"/>
                            </p:column>
                            <p:column style="width: 4%; text-align:center" headerText="Options">
                                <h:commandLink value="Edit" class="commandLink" actionListener="#{editHazard_MB.populateTree()}">
                                    <f:ajax event="click" listener="#{editHazard_MB.editHazard(item)}" execute="@form" render="@form"/>
                                </h:commandLink>
                            </p:column>
                        </p:dataTable>
                        <p:panel styleClass="hazardModifyPanel" rendered="#{editHazard_MB.showEdit}">
                            <p:panelGrid columns="2" columnClasses="left,middle">
                                <f:facet name="header">
                                    <p:outputPanel>
                                        <h:outputText value="Editing Hazard #{editHazard_MB.currentHazard.hazardId}"/>
                                    </p:outputPanel>
                                </f:facet>
                                <p:outputLabel value="Hazard Date:"/>
                                <p:calendar value="#{editHazard_MB.currentHazard.hazardDate}" title="HazardDate" required="true" requiredMessage="The HazardDate field is required." maxdate="#{editHazard_MB.currentDate()}"/>
                                <p:outputLabel value="Hazard Description:"  />
                                <p:inputTextarea rows="3" cols="60"  value="#{editHazard_MB.currentHazard.hazardDescription}" title="HazardDescription" required="true" requiredMessage="The HazardDescription field is required."/>
                                <p:outputLabel value="Hazard Comment:"/>
                                <p:inputTextarea rows="3" cols="60" value="#{editHazard_MB.currentHazard.hazardComment}" title="HazardComment"/>
                                <p:outputLabel value="Hazard Activity:"  />
                                <p:selectOneMenu value="#{editHazard_MB.editingHA}" required="true" requiredMessage="The Hazard Activity field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listHA}" var="ha" itemLabel="#{ha.activityName}" itemValue="#{ha.activityId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Hazard Context:"  />
                                <p:selectOneMenu  value="#{editHazard_MB.editingHC}"  required="true" requiredMessage="The HazardContextId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listHC}" var="hc" itemLabel="#{hc.hazardContextName}" itemValue="#{hc.hazardContextId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Hazard Type:"/>
                                <p:selectOneMenu value="#{editHazard_MB.editingHT}" required="true" requiredMessage="The HazardTypeId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listHT}" var="ht" itemLabel="#{ht.hazardTypeName}" itemValue="#{ht.hazardTypeId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Hazard Status:"/>
                                <p:selectOneMenu  value="#{editHazard_MB.editingHS}" required="true" requiredMessage="The HazardStatusId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listHS}" var="hs" itemLabel="#{hs.hazardStatusName}" itemValue="#{hs.hazardStatusId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Hazard Owner:"  />
                                <p:selectOneMenu  value="#{editHazard_MB.editingHO}" required="true" requiredMessage="The OwnerId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listHO}" var="ho" itemLabel="#{ho.ownerName}" itemValue="#{ho.ownerId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Hazard Workshop:"/>
                                <p:inputTextarea rows="2" cols="60"  value="#{editHazard_MB.currentHazard.hazardWorkshop}" title="HazardWorkshop" required="true" requiredMessage="The HazardWorkshop field is required."/>
                                <p:outputLabel value="Hazard Review:"  />
                                <p:selectOneMenu  value="#{editHazard_MB.currentHazard.hazardReview}" required="true" requiredMessage="The Hazard Review field is required." class="editInput" autoWidth="false">
                                    <f:selectItem itemLabel="Yes" itemValue="Y"/>
                                    <f:selectItem itemLabel="No" itemValue="N"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Risk Class"/>
                                <p:selectOneMenu value="#{editHazard_MB.editingRC}" required="true" requiredMessage="The Risk class field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listRC}" var="rc" itemLabel="#{rc.riskClassName}" itemValue="#{rc.riskClassId}"/> 
                                </p:selectOneMenu>
                                <p:outputLabel value="Risk Frequency:"/>
                                <p:selectOneMenu  value="#{editHazard_MB.editingRF}" required="true" requiredMessage="The RiskFrequencyId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listRF}" var="rf" itemLabel="#{rf.frequencyScore}" itemValue="#{rf.riskFrequencyId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Risk Severity:"/>
                                <p:selectOneMenu  value="#{editHazard_MB.editingRS}" required="true" requiredMessage="The RiskSeverityId field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listRS}" var="rs" itemLabel="#{rs.severityScore}" itemValue="#{rs.riskSeverityId}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="System Breakdown Structure:"/>
                                <p:tree id="sbsTree" value="#{editHazard_MB.root}" var="node" selectionMode="checkbox" selection="#{editHazard_MB.currentTree}">
                                    <p:treeNode>
                                        <p:outputLabel value="#{node}"/>
                                    </p:treeNode>
                                </p:tree>
                                <p:outputLabel value="Legacy ID:"/>
                                <p:inputText value="#{editHazard_MB.currentHazard.legacyId}" title="Legacy Id"/>
                                <p:outputLabel value="SSD Hazard Status" rendered="#{editHazard_MB.adminUser}"/>
                                <p:selectOneMenu value="#{editHazard_MB.currentHazard.hazardSystemStatus.systemStatusId}" rendered="#{editHazard_MB.adminUser}" required="true" requiredMessage="The SSD Hazard Status field is required." class="editInput" autoWidth="false">
                                    <f:selectItems value="#{editHazard_MB.listSS}" var="ss" itemLabel="#{ss.systemStatusName}" itemValue="#{ss.systemStatusId}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                        </p:panel>
                        <div class="panelButtons" style="display: #{(editHazard_MB.showEdit) ? 'block' : 'none'}">
                            <p:commandButton value="#{editHazard_MB.redirectionSource == 'UserWorkflow' ? 'Save changes and assign relations' : 'Save changes'}" action="#{editHazard_MB.editHazard()}" update="@form" />
                            <p:commandButton value="Cancel" immediate="true">
                                <f:ajax listener="#{editHazard_MB.cancelEdit()}" execute="@form" render="@form"/>
                            </p:commandButton>
                        </div>
                    </h:form>
                </f:view>
            </ui:define>
        </ui:composition>
    </body>
</html>
